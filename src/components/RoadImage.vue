<template>
  <v-row>

    <v-col cols="12" md="12">
      <v-card class="mx-auto">
        <v-card-text>
          <!-- place SVG source -->
          <div id="svgContainer">
            <svg id="svg1" version="1.1" viewBox="0 0 3303.6 1110.4" xmlns="http://www.w3.org/2000/svg">
              <defs id="defs1">
                <marker id="marker20" overflow="visible" markerHeight="1" markerWidth="1" orient="auto-start-reverse"
                        preserveAspectRatio="xMidYMid" viewBox="0 0 1 1">
                  <path id="path20" transform="scale(.7)"
                        d="m-0.21115-4.1056 6.4223 3.2111a1 1 90 0 1 0 1.7889l-6.4223 3.2111a1.2361 1.2361 31.717 0 1-1.7889-1.1056v-6a1.2361 1.2361 148.28 0 1 1.7889-1.1056z"
                        fill="context-stroke" fill-rule="evenodd"/>
                </marker>
                <marker id="RoundedArrow" overflow="visible" markerHeight="1" markerWidth="1"
                        orient="auto-start-reverse" preserveAspectRatio="xMidYMid" viewBox="0 0 1 1">
                  <path id="path17" transform="scale(.7)"
                        d="m-0.21115-4.1056 6.4223 3.2111a1 1 90 0 1 0 1.7889l-6.4223 3.2111a1.2361 1.2361 31.717 0 1-1.7889-1.1056v-6a1.2361 1.2361 148.28 0 1 1.7889-1.1056z"
                        fill="context-stroke" fill-rule="evenodd"/>
                </marker>
              </defs>
              <g id="layer1" transform="translate(1680.2 -100.98)">
                <text id="text60" transform="translate(-1740 98.477)" fill="#782121" font-family="Arial"
                      font-size="96px" font-weight="bold" stroke-width="5" text-align="center"
                      style="shape-inside:url(#rect65);white-space:pre" xml:space="preserve"><tspan id="tspan2" x="406.52109" y="831.74586">S<tspan
                  id="tspan1" baseline-shift="sub" font-size="65%">A</tspan>=</tspan></text>
                <g id="road" transform="translate(195.46 89.284)">
                  <rect id="rect11" x="-1829" y="636.53" width="3210.4" height="8.4618" fill="#666"
                        stroke-width=".54791"/>
                  <g id="g64" fill="#333" stroke-width=".14395">
                    <rect id="rect10" x="1304.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect12" x="1184.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect13" x="1064.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect14" x="944.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect15" x="824.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect16" x="704.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect22" x="584.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect23" x="464.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect25" x="344.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect27" x="224.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect28" x="104.54" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect29" x="-15.464" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect30" x="-135.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect31" x="-255.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect32" x="-375.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect33" x="-495.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect34" x="-615.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect35" x="-735.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect36" x="-855.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect37" x="-975.46" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect38" x="-1095.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect39" x="-1215.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect40" x="-1335.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect49" x="-1455.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect50" x="-1575.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect51" x="-1695.5" y="626.13" width="64.052" height="29.275"/>
                    <rect id="rect52" x="-1815.5" y="626.13" width="64.052" height="29.275"/>
                  </g>
                </g>
                <text id="text55" fill="#f6ffd5" font-family="Arial" font-size="96px" font-weight="bold"
                      text-align="center" style="shape-inside:url(#rect56);white-space:pre" xml:space="preserve"/>

                <rect id="marker" x="-34.379" y="100.98" width="12.016" height="742.77" fill="#ff2a7f" opacity=".7"
                      stroke-width="1.2633" :transform="`translate(${svg.marker.x}, 0)`"/>
                <g id="vehicle1" :transform="`translate(${svg.vehicle1.x} 89.284)`">
                  <rect id="rect41" x="-1820.9" y="394.42" width="107.09" height="87.615" fill="#a02c2c"
                        stroke-width=".97675"/>
                  <rect id="rect42" x="-1628.1" y="419.09" width="42.839" height="62.948" fill="#a02c2c"
                        stroke-width=".92884"/>
                  <g id="g44" transform="translate(-2397)" fill="#782121">
                    <rect id="rect43" x="568" y="373" width="123.31" height="21.42"/>
                    <rect id="rect44" transform="scale(1,-1)" x="761.75" y="-419.09" width="57.113" height="21.42"
                          stroke-width=".62561"/>
                  </g>
                  <g id="g46" transform="translate(-1931.6 240.31)" fill="#ffd42a" stroke-width="1.0642">
                    <circle id="circle44" cx="153.34" cy="353.37" r="32.451"/>
                    <circle id="circle45" cx="313.34" cy="353.37" r="32.451"/>
                    <circle id="circle46" cx="233.34" cy="353.37" r="32.451"/>
                  </g>
                  <rect id="rect46" x="-1784.3" y="589.12" width="172.12" height="10.619" fill="#a02c2c"
                        stroke-width="2.1514"/>
                  <rect id="rect47" x="-1820.9" y="482.04" width="257.03" height="107.09" fill="#c83737"/>
                  <path id="path47" d="m-1497.3 589.14-66.56-0.0133v-107.09z" fill="#333" stroke-width="1.215"/>
                  <rect id="rect48" x="-1797.2" y="415.42" width="59.664" height="66.617" fill="#80b3ff"
                        stroke-width=".99084"/>

                  <text id="text73" x="-1692.1874" y="569.9389" fill="#782121" font-family="Arial" font-size="96px"
                        font-weight="bold" text-align="center" text-anchor="middle" xml:space="preserve"><tspan id="tspan73" x="-1692.1874" y="569.9389" fill="#782121">A</tspan></text>
                </g>
                <g id="vehicle2" :transform="`translate(${svg.vehicle2.x} 89.284)`">
                  <rect id="rect2" transform="scale(-1,1)" x="-1373.2" y="394.42" width="107.09" height="87.615"
                        fill="#8a0" stroke-width=".97675"/>
                  <rect id="rect3" transform="scale(-1,1)" x="-1180.5" y="419.09" width="42.839" height="62.948"
                        fill="#8a0" stroke-width=".92884"/>
                  <g id="g5" transform="matrix(-1 0 0 1 1949.3 0)" fill="#668000">
                    <rect id="rect4" x="568" y="373" width="123.31" height="21.42"/>
                    <rect id="rect5" transform="scale(1,-1)" x="761.75" y="-419.09" width="57.113" height="21.42"
                          stroke-width=".62561"/>
                  </g>
                  <g id="g7" transform="matrix(-1 0 0 1 1483.9 240.31)" fill="#ffd42a" stroke-width="1.0642">
                    <circle id="circle5" cx="153.34" cy="353.37" r="32.451"/>
                    <circle id="circle6" cx="313.34" cy="353.37" r="32.451"/>
                    <circle id="circle7" cx="233.34" cy="353.37" r="32.451"/>
                  </g>
                  <rect id="rect7" transform="scale(-1,1)" x="-1336.6" y="589.12" width="172.12" height="10.619"
                        fill="#8a0" stroke-width="2.1514"/>
                  <rect id="rect8" transform="scale(-1,1)" x="-1373.2" y="482.04" width="257.03" height="107.09"
                        fill="#bcd35f"/>
                  <path id="path8" d="m1049.6 589.14 66.56-0.0133v-107.09z" fill="#333" stroke-width="1.215"/>
                  <rect id="rect9" transform="scale(-1,1)" x="-1349.5" y="415.42" width="59.664" height="66.617"
                        fill="#80b3ff" stroke-width=".99084"/>
                  <text id="text74" x="1244.8927" y="569.9389" fill="#668000" font-family="Arial" font-size="96px"
                        font-weight="bold" text-align="center" text-anchor="middle" xml:space="preserve"><tspan id="tspan74" x="1244.8927" y="569.9389" fill="#668000">B</tspan></text>
                </g>
                <rect id="rect53" x="-1323.4" y="255.33" width="21.585" height="588.42" fill="#808080"
                      stroke-width=".848"/>
                <g id="g59" transform="translate(241.53 384)">
                  <rect id="rect54" x="-1834.7" y="-139.32" width="561.21" height="131.47" fill="#8a0"/>
                  <text id="city_a" transform="translate(1.4533 13.061)" fill="#f6ffd5" font-family="Arial"
                        font-size="96px" font-weight="bold" text-align="center"
                        style="shape-inside:url(#rect57);white-space:pre" xml:space="preserve"><tspan id="tspan3" x="-1752.3584" y="-52.849841">{{
                      labelCityA
                    }}</tspan></text>
                </g>
                <path id="road_sa" :d="`m-1279.2 843.75h${svg.distanceA.x}`" fill="none" marker-end="url(#marker20)"
                      marker-start="url(#RoundedArrow)" stroke="#c83737" stroke-width="4.8885"/>

                <path id="road_sb" :d="`m${svg.distanceB.x} 843.75h${svg.distanceBLength.x}`" fill="none"
                      marker-end="url(#marker20)" marker-start="url(#RoundedArrow)" stroke="#8a0"
                      stroke-width="4.8883"/>
                <g>
                  <g font-family="Arial" font-size="96px" font-weight="bold" stroke-width="5">
                    <text id="value_sa" transform="translate(-1560 98.477)" fill="#782121" text-align="center"
                          style="shape-inside:url(#rect21);white-space:pre" xml:space="preserve"><tspan id="tspan4" x="409.01367" y="831.74586">{{
                        labelVehicle1DistnaceValue
                      }} {{ labelDistanceUnit }}</tspan></text>
                    <text id="value_sb" transform="translate(702.15 98.477)" fill="#668000" text-align="center"
                          style="shape-inside:url(#rect24);white-space:pre" xml:space="preserve"><tspan id="tspan6" x="409.01367" y="831.74586">{{
                        labelVehicle2DistnaceValue
                      }} {{ labelDistanceUnit }}</tspan></text>
                    <text id="value_ta" transform="translate(-1560 218.48)" fill="#c83737" text-align="center"
                          style="shape-inside:url(#rect26);white-space:pre" xml:space="preserve"><tspan id="tspan7" x="409.01367" y="831.74586">{{
                        labelVehicle1TimeUnit
                      }}</tspan></text>
                    <text id="value_va" transform="translate(-1560 338.48)" fill="#de8787" text-align="center"
                          style="shape-inside:url(#rect45);white-space:pre" xml:space="preserve"><tspan id="tspan8" x="409.01367" y="831.74586">{{
                        labelVehicle1VelocityValue
                      }} {{ labelSpeedUnit }}</tspan></text>
                    <text id="value_tb" transform="translate(702.15 218.48)" fill="#abc837" text-align="center"
                          style="shape-inside:url(#rect58);white-space:pre" xml:space="preserve"><tspan id="tspan9" x="409.01367" y="831.74586">{{
                        labelVehicle1TimeUnit
                      }}</tspan></text>
                    <text id="value_vb" transform="translate(702.15 338.48)" fill="#cdde87" text-align="center"
                          style="shape-inside:url(#rect60);white-space:pre" xml:space="preserve"><tspan id="tspan10" x="409.01367" y="831.74586">{{
                        labelVehicle2VelocityValue
                      }} {{ labelSpeedUnit }}</tspan></text>
                    <text id="text69" transform="translate(-1740 218.48)" fill="#c83737" text-align="center"
                          style="shape-inside:url(#rect69);white-space:pre" xml:space="preserve"><tspan id="tspan12" x="409.21641" y="831.74586">T<tspan
                      id="tspan11" baseline-shift="sub" font-size="65%">A</tspan>=</tspan></text>
                    <text id="text71" transform="translate(-1740 338.48)" fill="#de8787" text-align="center"
                          style="shape-inside:url(#rect71);white-space:pre" xml:space="preserve"><tspan id="tspan14" x="406.52109" y="831.74586">V<tspan
                      id="tspan13" baseline-shift="sub" font-size="65%">A</tspan>=</tspan></text>
                    <text id="text75" transform="translate(531.18 98.477)" fill="#668000" text-align="center"
                          style="shape-inside:url(#rect76);white-space:pre" xml:space="preserve"><tspan id="tspan16" x="406.52109" y="831.74586">S<tspan
                      id="tspan15" baseline-shift="sub" font-size="65%">B</tspan>=</tspan></text>
                    <text id="text80" transform="translate(531.18 218.48)" fill="#abc837" text-align="center"
                          style="shape-inside:url(#rect80);white-space:pre" xml:space="preserve"><tspan id="tspan18" x="409.21641" y="831.74586">T<tspan
                      id="tspan17" baseline-shift="sub" font-size="65%">B</tspan>=</tspan></text>
                    <text id="text82" transform="translate(531.18 338.48)" fill="#cdde87" text-align="center"
                          style="shape-inside:url(#rect82);white-space:pre" xml:space="preserve"><tspan id="tspan20" x="406.52109" y="831.74586">V<tspan
                      id="tspan19" baseline-shift="sub" font-size="65%">B</tspan>=</tspan></text>
                  </g>
                  <rect id="rect62" x="1245" y="260.18" width="21.585" height="583.57" fill="#808080"
                        stroke-width=".8445"/>
                </g>
                <g id="g63" transform="translate(2809.9 388.85)">
                  <rect id="rect63" x="-1834.7" y="-139.32" width="561.21" height="131.47" fill="#8a0"/>
                  <text id="city_b" transform="translate(1.4533 13.061)" fill="#f6ffd5" font-family="Arial"
                        font-size="96px" font-weight="bold" text-align="center"
                        style="shape-inside:url(#rect64);white-space:pre" xml:space="preserve"><tspan id="tspan21" x="-1754.1396" y="-52.849841">{{
                      labelCityB
                    }}</tspan></text>
                </g>
              </g>
            </svg>

          </div>

        </v-card-text>
      </v-card>
    </v-col>
  </v-row>

</template>

<script>
import CalculatorMixin from "@/mixins/CalculatorMixin";

export default {
  name: "RoadImage",
  mixins: [CalculatorMixin],
  props: {
    data: {
      type: Object,
      required: true
    }
  },
  data() {
    return {
      svgWidth: 966,
      svg: {
        cityA: {name: this.$t("cityA")},
        cityB: {name: this.$t("cityB")},
        vehicle1: {x: 195.46, color: "#FF9800", start: 195.46, end: 2760.0, distance: 0, time: 0, speed: 0},
        vehicle2: {x: 195.46, color: "#03A9F4", start: -2360.0, end: 195.46, distance: 0, time: 0, speed: 0},
        marker: {x: 0, color: "#E91E63", start: -1280, end: 1280},
        distanceA: {x: 1220, color: "#c83737", start: 0, end: 2500}, // 1220.0
        distanceB: {x: 0, color: "#c83737", start: -1280, end: 1250.0}, // 0
        distanceBLength: {x: 1221.8, color: "#c83737", length: 1230},
        markerArrows: {x: 487, color: "#E91E63", start: 142, end: 914},
      },
      dataToCalculate: {
        train1: {
          startCity: "Warszawa",
          distanceKm: null,
          timeHours: null,
          speedKmPerHour: 70,
          direction: "right"
        },
        train2: {
          startCity: "Kraków",
          distanceKm: null,
          timeHours: null,
          speedKmPerHour: 25,
          direction: "left"
        },
        totalCitiesDistance: 300,
      },
    }
  },
  methods: {
    toPercentage(value, total) {
      return ((value / total) * 100).toFixed(2);
    },
    toPixels(value, total) {
      return (value / total) * this.svgWidth;
    },
    toPointsFromPercentage(value, start, stop) {
      return (value / 100) * (stop - start) + start;
    },
    toPoints(value, start, stop) {
      return (value / this.svgWidth) * (stop - start) + start;
    },
    calculateToSvg() {
      const percentage = this.distanceToMeetFromAPercentage;
      this.svg.vehicle1.x = this.toPointsFromPercentage(percentage, this.svg.vehicle1.start, this.svg.vehicle1.end);
      this.svg.vehicle2.x = this.toPointsFromPercentage(percentage, this.svg.vehicle2.start, this.svg.vehicle2.end);
      this.svg.marker.x = this.toPointsFromPercentage(percentage, this.svg.marker.start, this.svg.marker.end);
      this.svg.markerArrows.x = this.toPointsFromPercentage(percentage, this.svg.markerArrows.start, this.svg.markerArrows.end);

      this.svg.distanceA.x = this.toPointsFromPercentage(percentage, this.svg.distanceA.start, this.svg.distanceA.end);
      this.svg.distanceB.x = this.toPointsFromPercentage(percentage, this.svg.distanceB.start, this.svg.distanceB.end);
      this.svg.distanceBLength.x = 1230 - this.svg.distanceB.x;

      const distanceA = this.dataToCalculate.distanceToMeetFromA;
      const distanceB = this.dataToCalculate.distanceTotal - distanceA;
      const timeToMeet = this.dataToCalculate.timeToMeet;
      const speedA = this.dataToCalculate.velocity1;
      const speedB = this.dataToCalculate.velocity2;
      this.svg.vehicle1.distance = distanceA ? parseFloat(distanceA).toFixed(1) : 0;
      this.svg.vehicle2.distance = distanceB ? parseFloat(distanceB).toFixed(1) : 0;
      this.svg.vehicle1.time = timeToMeet;
      this.svg.vehicle2.time = this.svg.vehicle1.time;
      this.svg.vehicle1.speed = speedA ? parseFloat(speedA).toFixed(1) : 0;
      this.svg.vehicle2.speed = speedB ? parseFloat(speedB).toFixed(1) : 0;
    },
  },
  computed: {
    distanceTotal() {
      return this.dataToCalculate.distanceTotal;
    },
    timeToMeet() {
      return this.dataToCalculate.train1.timeHours + this.dataToCalculate.train2.timeHours;
    },
    distanceToMeetFromA() {
      const percent = this.toPercentage(this.data.distanceToMeetFromA, this.data.distanceTotal);
      return this.dataToCalculate.distanceToMeetFromA;
    },
    distanceToMeetFromB() {
      return this.dataToCalculate.distanceToMeetFromB;
    },
    speed1() {
      return this.dataToCalculate.velocity1;
    },
    speed2() {
      return this.dataToCalculate.velocity2;
    },

    distanceTotalPercentage() {
      return this.toPercentage(this.dataToCalculate.distanceTotal, this.dataToCalculate.distanceTotal);
    },
    distanceToMeetFromAPercentage() {
      return this.toPercentage(this.data.distanceToMeetFromA, this.data.distanceTotal);
    },
    distanceToMeetFromBPercentage() {
      return this.toPercentage(this.dataToCalculate.distanceToMeetFromB, this.dataToCalculate.totalCitiesDistance);
    },

    labelCityA() {
      return this.$t("cityA");
    },
    labelCityB() {
      return this.$t("cityB");
    },
    labelVehicle1VelocityValue() {
      return this.svg.vehicle1.speed ?? 0;
    },
    labelVehicle2VelocityValue() {
      return this.svg.vehicle2.speed ?? 0;
    },
    labelVehicle1DistnaceValue() {
      return this.svg.vehicle1.distance ?? 0;
    },
    labelVehicle2DistnaceValue() {
      return this.svg.vehicle2.distance ?? 0;
    },
    labelVehicle1TimeValue() {
      return this.svg.vehicle1.time ?? 0;
    },
    labelVehicle2TimeValue() {
      return this.svg.vehicle2.time ?? 0;
    },
    labelDistanceUnit() {
      return this.$t("distanceUnitKm");
    },
    labelSpeedUnit() {
      return this.$t("velocityUnitKmPHr");
    },
    labelVehicle1TimeUnit() {
      return this.svg.vehicle1.time ? this.convertHoursToHumanReadable(this.svg.vehicle1.time) : 0;
    },
    labelVehicle2TimeUnit() {
      return this.labelVehicle1TimeUnit;
    },
    

    


  },
  watch: {
    data: {
      immediate: true,
      handler(newData) {
        this.dataToCalculate = newData;
      }
    },
    distanceToMeetFromA: function (newValue) {
      const percentage = this.distanceToMeetFromAPercentage;
      this.svg.vehicle1.x = this.toPointsFromPercentage(percentage, this.svg.vehicle1.start, this.svg.vehicle1.end);
      this.svg.vehicle2.x = this.toPointsFromPercentage(percentage, this.svg.vehicle2.start, this.svg.vehicle2.end);
      this.svg.marker.x = this.toPointsFromPercentage(percentage, this.svg.marker.start, this.svg.marker.end);
      this.svg.markerArrows.x = this.toPointsFromPercentage(percentage, this.svg.markerArrows.start, this.svg.markerArrows.end);

      this.calculateToSvg();
    },
  },
}
</script>
